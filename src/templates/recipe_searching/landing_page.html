{% extends 'base.html' %}

{% block title %}Search{% endblock %}

{% block main_container %}

{# Search for recipes #}
<div id="search_container">
    <h2>Search By</h2>
    <br>

    <span>Recipe Title:</span>
    <input type="text" id="title">
    
    <span>Ingredients:</span>
    <input type="text" id="ingredients">
    
    <br>
    
    <button id="confirm_search">Search</button>
    
    <br>

    <h2>Recipe List</h2>
    <ul id="recipe_list"></ul>

</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get the search button
        var searchButton = document.getElementById('confirm_search');

        // Add a click event listener to the search button
        searchButton.addEventListener('click', function () {
            // Get the input values
            var titleInput = document.getElementById('title').value;

            // Create a new XMLHttpRequest object
            var xhr = new XMLHttpRequest();

            // Configure it to send a POST request to the /search_recipe route
            xhr.open('POST', '/search_recipe', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

            // Define the callback function when the request is complete
            xhr.onload = function () {
                if (xhr.status === 200) {
                    // Parse the JSON response
                    var response = JSON.parse(xhr.responseText);

                    // Check if the recipe is not found
                    if (response[titleInput] === 'not found') {
                        // Display a message on the webpage
                        alert('Recipe not found!');
                    } else {
                        // Update the recipe list based on the response
                        updateRecipeList(response);
                    }
                }
            };

            // Send the request with the title as data
            xhr.send('recipe_title=' + encodeURIComponent(titleInput));
        });

        // Function to update the recipe list
        function updateRecipeList(recipes) {
            // Get the recipe list element
            var recipeList = document.getElementById('recipe_list');

            // Clear the existing list
            recipeList.innerHTML = '';

            // Populate the list with the retrieved recipes
            for (var recipeTitle in recipes) {
                var listItem = document.createElement('li');
                listItem.textContent = recipeTitle + ': ' + recipes[recipeTitle];
                recipeList.appendChild(listItem);
            }
        }
    });
</script>
{% endblock %}